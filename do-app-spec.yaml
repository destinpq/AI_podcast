name: ai-podcast-app # Choose a unique name for your app
region: nyc # Choose a region (e.g., nyc, sfo, lon, fra)

services:
  # Backend NestJS Service
  - name: backend
    git:
      repo: https://github.com/pratikk94/ai_podcast.git # Your repo URL
      branch: main
      deploy_on_push: true
    build_command: cd backend && npm install && npm run build
    run_command: cd backend && npm run start:prod
    http_port: 7778
    instance_size_slug: basic-xs # Choose an appropriate size
    instance_count: 1
    routes:
      - path: / # Expose backend at the root of its subdomain
    envs:
      - key: PORT
        value: "7778"
      - key: CLIENT_URL
        value: "${APP_URL}" # Will use the frontend URL automatically
      - key: OPENAI_API_KEY
        value: "ADD_SECRET_IN_UI" # Placeholder - ADD SECRET IN UI LATER
        type: SECRET
      - key: NODE_ENV
        value: "production"
      # Add any other backend-specific env vars here

  # Frontend Next.js Service
  - name: frontend
    git:
      repo: https://github.com/pratikk94/ai_podcast.git # Your repo URL
      branch: main
      deploy_on_push: true
    build_command: npm install && npm run build:frontend
    run_command: npm run start:frontend
    http_port: 3000
    instance_size_slug: basic-xs # Choose an appropriate size
    instance_count: 1
    routes:
      - path: / # Expose frontend at the root of its subdomain
    envs:
      - key: PORT
        value: "3000"
      - key: NEXT_PUBLIC_BACKEND_URL
        value: "https://shark-app-fg9yo.ondigitalocean.app" # Updated with actual backend URL
      - key: NEXT_PUBLIC_FIREBASE_API_KEY
        value: "AIzaSyCfNYW6t7mGLzxgg_opsFA9ZtvxUW6N0C8"
      - key: NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN
        value: "ai-tracker-90ce0.firebaseapp.com"
      - key: NEXT_PUBLIC_FIREBASE_DATABASE_URL
        value: "https://ai-tracker-90ce0-default-rtdb.firebaseio.com"
      - key: NEXT_PUBLIC_FIREBASE_PROJECT_ID
        value: "ai-tracker-90ce0"
      - key: NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET
        value: "ai-tracker-90ce0.firebasestorage.app"
      - key: NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID
        value: "954189815072"
      - key: NEXT_PUBLIC_FIREBASE_APP_ID
        value: "1:954189815072:web:98d57df0f28bdfb50d4b45"
      - key: NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID
        value: "G-Y294P6WKYP"
      - key: NODE_ENV
        value: "production"
      - key: NEXT_DISABLE_ESLINT
        value: "1"
      # Note: NEXT_PUBLIC_* vars should have type: GENERAL (default) 